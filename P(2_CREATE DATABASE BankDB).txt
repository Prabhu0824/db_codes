CREATE DATABASE BankDB;
USE BankDB;

CREATE TABLE Bank (
    bank_id INT PRIMARY KEY,
    bank_name VARCHAR(100) NOT NULL,
    ho_address VARCHAR(200),
    contactno VARCHAR(15) UNIQUE NOT NULL
);

CREATE TABLE Branch (
    branch_id INT PRIMARY KEY,
    bank_id INT NOT NULL,
    branch_name VARCHAR(80) NOT NULL,
    ifsc VARCHAR(20) UNIQUE NOT NULL,
    city VARCHAR(100),
    state VARCHAR(100),
    pincode VARCHAR(10),
    FOREIGN KEY (bank_id) REFERENCES Bank(bank_id)
);

CREATE TABLE Customer (
    customerid INT PRIMARY KEY,
    fname VARCHAR(50) NOT NULL,
    mname VARCHAR(50),
    lname VARCHAR(50) NOT NULL,
    gender CHAR(1) CHECK (gender IN ('M', 'F')),
    dob DATE NOT NULL,
    phone VARCHAR(15) UNIQUE NOT NULL,
    create_on DATE DEFAULT (CURRENT_DATE)
);

CREATE TABLE Account (
    account_id INT PRIMARY KEY,
    customer_id INT NOT NULL,
    branch_id INT NOT NULL,
    account_no VARCHAR(20) UNIQUE NOT NULL,
    account_type VARCHAR(20) CHECK (account_type IN ('Saving', 'Current', 'Fixed')),
    balance DECIMAL(12,2) CHECK (balance >= 0),
    status VARCHAR(20) DEFAULT 'Active',
    open_on DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (customer_id) REFERENCES Customer(customerid),
    FOREIGN KEY (branch_id) REFERENCES Branch(branch_id)
);

ALTER TABLE Customer
ADD email VARCHAR(120) UNIQUE;

ALTER TABLE Branch
MODIFY branch_name VARCHAR(120);

RENAME TABLE Account TO CustomerAccount;

ALTER TABLE Branch
CHANGE COLUMN ifsc ifsc_code VARCHAR(20) UNIQUE NOT NULL;

CREATE INDEX idx_branchid ON CustomerAccount(branch_id);
